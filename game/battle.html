<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Battle Screen</title>
    <link rel="stylesheet" href="battle.css">
</head>

<body>
    <h1>Battle Screen</h1>

<<<<<<< HEAD
=======


>>>>>>> origin/main
    <script src="../assets/js/enemies.js"></script>

    <div id="enemy-info">
        <h2 id="enemy-name"></h2>
        <p>HP: <span id="enemy-hp"></span></p>
        <img id="enemy-image" src="" alt="Enemy Image" width="800">
<<<<<<< HEAD
        <p>Gold: <span id="enemy-gold"></span></p> <!-- Show enemy gold -->
=======
>>>>>>> origin/main
    </div>

    <div id="character-info">
        <h2 id="player-name"></h2>
        <p>HP: <span id="player-hp"></span></p>
<<<<<<< HEAD
        <p>Gold: <span id="gold"></span></p>
=======
>>>>>>> origin/main
    </div>

    <div id="console">
        <p id='battleText'>Ambush!</p>
    </div>

    <div id="abilities">
        <h3>Abilities</h3>
    </div>

    <div id="ability-buttons">
        <button class="attack-btn" onclick="playerAttack(0)">Attack 1</button>
        <button class="attack-btn" onclick="playerAttack(1)">Attack 2</button>
    </div>
<<<<<<< HEAD

    <div id="special-button-container" style="display: none;"></div>
=======
>>>>>>> origin/main

    <script>
        const params = new URLSearchParams(window.location.search);
        const charData = params.get("character");

<<<<<<< HEAD
        let enemyDefeated = false;
        let playerDefeated = false;

=======
>>>>>>> origin/main
        if (charData) {
            const character = JSON.parse(decodeURIComponent(charData));
            playerHP = character.hp;
            playerAbilities = character.abilities;
            playerName = character.name;
<<<<<<< HEAD
            playerGold = character.gold;
=======
>>>>>>> origin/main
        }

        function displayAbilityNames() {
            const buttons = document.querySelectorAll('.attack-btn');

            buttons.forEach((btn, index) => {
                if (playerAbilities[index]) {
                    // Create wrapper
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('ability-wrapper');

                    // Create text
                    const text = document.createElement('span');
                    text.classList.add('ability-text');
                    text.textContent = playerAbilities[index].name;

                    // Wrap button
                    btn.parentNode.insertBefore(wrapper, btn);
                    wrapper.appendChild(btn);
                    wrapper.appendChild(text);
                }
            });
        }

        // -------------------------
        // Enemy setup
        // -------------------------
        const enemyList = enemies.enemies;
        const randomEnemy = enemyList[Math.floor(Math.random() * enemyList.length)];

        let enemyName = randomEnemy.name;
        let enemyHP = randomEnemy.hp;
        const enemyAbilities = randomEnemy.abilities;
        let enemyImage = randomEnemy.animations.idle;
        const enemyFlavor = randomEnemy.flavor;
<<<<<<< HEAD
        let enemyGold = randomEnemy.gold || 0; // Get enemy gold value
=======
>>>>>>> origin/main

        document.getElementById('enemy-name').textContent = enemyName;
        document.getElementById('enemy-hp').textContent = enemyHP;
        document.getElementById('battleText').textContent = `A wild ${enemyName} appears! ${enemyFlavor}`;
        document.getElementById('enemy-image').src = enemyImage;
<<<<<<< HEAD
        document.getElementById('enemy-gold').textContent = enemyGold; // Display enemy gold
=======
>>>>>>> origin/main

        // -------------------------
        // Initialize displays
        // -------------------------
        // Update player display
        document.getElementById('player-name').textContent = playerName;
        document.getElementById('player-hp').textContent = playerHP;
<<<<<<< HEAD
        document.getElementById('gold').textContent = playerGold;
=======
>>>>>>> origin/main

        // Update button text with imported abilities
        const buttons = document.querySelectorAll('.attack-btn');
        buttons.forEach((btn, index) => {
            if (playerAbilities[index]) {
                btn.textContent = playerAbilities[index].name;
            }
        });

        // -------------------------
        // Display update functions
        // -------------------------
        function updateEnemyDisplay() {
            console.log('Updating enemy image to:', enemyImage);
            document.getElementById('enemy-hp').textContent = enemyHP;
            document.getElementById('enemy-image').src = enemyImage;
<<<<<<< HEAD
            document.getElementById('enemy-gold').textContent = enemyGold;
=======
>>>>>>> origin/main
        }

        function updatePlayerDisplay() {
            document.getElementById('player-hp').textContent = playerHP;
<<<<<<< HEAD
            document.getElementById('gold').textContent = playerGold;
=======
>>>>>>> origin/main
        }

        // -------------------------
        // Debug enemy animations
        // -------------------------
        console.log('Enemy animations:', {
            idle: randomEnemy.animations.idle,
            attack: randomEnemy.animations.attack,
            death: randomEnemy.animations.death
        });

        // Test if images load
        console.log('Testing if attack animation loads...');
        const testImg = new Image();
        testImg.onload = () => console.log('Attack animation loaded successfully');
        testImg.onerror = () => console.error('Attack animation failed to load');
        testImg.src = randomEnemy.animations.attack;

        // -------------------------
        // Battle logic functions
        // -------------------------
        function move(name, damage, heal) {
            playerHP += heal;
            enemyHP -= damage;

            if (playerHP < 0) playerHP = 0;
            if (enemyHP < 0) enemyHP = 0;

            console.log(`Player used ${name}! Deals ${damage} damage, heals ${heal}.`);
            document.getElementById('battleText').innerText = `Player used ${name}! Deals ${damage} damage, heals ${heal}.`;

            updateEnemyDisplay();
            updatePlayerDisplay();
        }

        function enemyMove(name, damage, heal) {
            enemyHP += heal;
            playerHP -= damage;

            if (playerHP < 0) playerHP = 0;
            if (enemyHP < 0) enemyHP = 0;

            console.log(`Enemy used ${name}! Deals ${damage} damage, heals ${heal}.`);
            document.getElementById('battleText').innerText = `Enemy used ${name}! Deals ${damage} damage, heals ${heal}.`;

            updateEnemyDisplay();
            updatePlayerDisplay();
        }

        // -------------------------
        // HUD rendering
        // -------------------------
        const hud = document.getElementById("character-info");

        // -------------------------
        // Attack logic
        // -------------------------
        function playerAttack(index) {
            if (!playerAbilities[index]) return;

            const ability = playerAbilities[index];
            move(ability.name, ability.damage, ability.heal);

            // Check if enemy died from player attack
            if (enemyHP <= 0) {
                enemyImage = randomEnemy.animations.death;
                updateEnemyDisplay(); // IMMEDIATELY update to show death
<<<<<<< HEAD

                // Award gold to player
                if (!enemyDefeated) {
                    playerGold += enemyGold;
                    document.getElementById('gold').textContent = playerGold;
                    document.getElementById('battleText').innerText += `\nYou found ${enemyGold} gold!`;
                    enemyGold = 0; // Enemy drops gold only once
                    updateEnemyDisplay();
                }

=======
>>>>>>> origin/main
                checkBattleOutcome();
                return; // Don't do enemy counterattack if enemy is dead
            }

            // Enemy counterattack
            setTimeout(() => {
                // Show enemy attack animation
                enemyImage = randomEnemy.animations.attack;
                updateEnemyDisplay(); // IMMEDIATELY update to show attack

                // Wait for animation, then execute enemy move
                setTimeout(() => {
                    const enemyAbility = enemyAbilities[Math.floor(Math.random() * enemyAbilities.length)];
                    enemyMove(enemyAbility.name, enemyAbility.damage, enemyAbility.heal);

                    // Return to idle after enemy move
                    setTimeout(() => {
                        enemyImage = randomEnemy.animations.idle;
                        updateEnemyDisplay(); // IMMEDIATELY update to show idle
                        checkBattleOutcome();
                    }, 500);
                }, 1000);
            }, 500);
        }

        function checkBattleOutcome() {
            if (playerHP <= 0) {
                document.getElementById('battleText').innerText = "You were defeated!";
<<<<<<< HEAD
                playerDefeated = true;
            } else if (enemyHP <= 0) {
                enemyImage = randomEnemy.animations.death;
                updateEnemyDisplay();
                document.getElementById('battleText').innerText += `\nYou defeated the ${enemyName}!`;

                enemyDefeated = true;
                showSpecialButton();
=======
            } else if (enemyHP <= 0) {
                enemyImage = randomEnemy.animations.death;
                updateEnemyDisplay();
                document.getElementById('battleText').innerText = `You defeated the ${enemyName}!`;
>>>>>>> origin/main
            }
        }

        // Initial render

<<<<<<< HEAD
        function showSpecialButton() {
            if (!enemyDefeated) return;

            const container = document.getElementById('special-button-container');

            if (container.childElementCount === 0) {
                const specialBtn = document.createElement('button');
                specialBtn.classList.add('attack-btn');
                specialBtn.textContent = "Return to Overworld";

                specialBtn.onclick = () => {
                    // Reset HP to full
                    playerHP = playerAbilities.reduce((max, ability) => Math.max(max, ability.heal + max), 100); // or set a default max HP

                    // Prepare data to pass via URL
                    const playerData = {
                        name: playerName,
                        hp: playerHP,
                        gold: playerGold,    // preserve gold
                        abilities: playerAbilities
                    };

                    // Encode and navigate
                    const query = encodeURIComponent(JSON.stringify(playerData));
                    window.location.href = `overworld.html?character=${query}`;
                };

                container.appendChild(specialBtn);
            }

            container.style.display = "block";
        }

    </script>
</body>
</html>




=======
    </script>




</body>

</html> 



 
>>>>>>> origin/main
