<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Overworld</title>
  <link rel="stylesheet" href="overworld.css">
</head>

<body>

  <div id="title-container">
    <img id="overworld-title" src="../assets/sprites/title_bar.png" alt="Overworld Title">
    <span id="title_name">Overworld</span>
  </div>

  <!-- Character Display Card -->
  <div id="character-card" class="hero-card">
    <div class="card-background">
      <div class="character-portrait">
        <img id="hero-image" src="" alt="Selected Hero">
      </div>
      <div class="character-stats">
        <h2 id="hero-name"></h2>
        <div class="stat-row">
          <div class="stat-item">
            <span class="stat-label">Health:</span>
            <span id="hero-health" class="stat-value"></span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Gold:</span>
            <span id="hero-gold" class="stat-value"></span>
          </div>
        </div>
        <div class="character-flavor">
          <p id="hero-flavor"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Status message -->
  <div id="status-message" class="status-text"></div>

  <!-- Buttons to go to new areas -->
  <div class="location-buttons">
    <button data-region="forest">Go to Forest</button>
    <button data-region="temple">Visit Temple</button>
    <button data-region="dungeon">Enter Dungeon</button>
    <button data-region="shop">Visit Shop</button>
  </div>
  <script src="../assets/js/regions.js"></script>
  <script>
    const buttonSound = new Audio("../assets/sound/button_sound.mp3");
    const qs = new URLSearchParams(window.location.search);
    const statusEl = document.getElementById("status-message");
    const buttons = document.querySelectorAll(".location-buttons button");

    // Load character data from URL params
    const charData = qs.get("character");

    let character = null;
    if (charData) {
      character = JSON.parse(decodeURIComponent(charData));

      // Populate the character card
      document.getElementById("hero-image").src = character.image;
      document.getElementById("hero-image").alt = character.name;
      document.getElementById("hero-name").textContent = character.name;
      document.getElementById("hero-health").textContent = `${character.currentHp}/${character.maxHp}`;
      document.getElementById("hero-gold").textContent = character.gold;
      document.getElementById("hero-flavor").textContent = character.flavor;
    }

    // Display status message based on region
    (function updateStatus() {
      const region = qs.get("region_type");
      const cap = r => r ? r[0].toUpperCase() + r.slice(1) : r;

      if (!region) {
        statusEl.textContent = "You entered the world fresh for adventure.";
      } else {
        statusEl.innerHTML = `You have returned from adventuring the <strong style="color: red;">${cap(region)}</strong> and are ready to move on to the next location.`;
      }
    })();

    // Destination mapper
    function getDestination(region) {
      switch (region) {
        case "shop": return "shop.html";
        case "forest": return "forest_battle.html";
        case "temple": return "temple_battle1.html";
        case "dungeon": return "dungeon_battle.html";
        default: return "overworld.html";
      }
    }

    // Navigate helper
    function go(region) {
      buttonSound.currentTime = 0;
      buttonSound.play();

      if (!character) return;

      // Preserve character data
      const charData = encodeURIComponent(JSON.stringify(character));
      const next = new URLSearchParams();
      next.set("character", charData);
      next.set("region_type", region);

      // Correct destination
      const dest = getDestination(region);

      // Navigate
      location.href = `${dest}?${next.toString()}`;
    }

    // Wire buttons + set active state
    (function setupButtons() {
      const current = qs.get("region_type");
      if (current) {
        buttons.forEach(b => b.classList.toggle("active", b.dataset.region === current));
      }

      buttons.forEach(btn => {
        const region = btn.dataset.region;
        btn.addEventListener("click", () => go(region));
        btn.addEventListener("touchend", (e) => {
          e.preventDefault();
          go(region);
        }, { passive: false });
      });
    })();
  </script>
  <script src="../assets/js/cursor.js"></script>
</body>

</html>
