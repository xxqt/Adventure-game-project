<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Battle Screen</title>
    <link rel="stylesheet" href="boss.css">
</head>

<body>
    <h1>Battle Screen</h1>



    <script src="../assets/js/boss.js"></script>

    <div id="enemy-info">
        <h2 id="enemy-name"></h2>
        <p>HP: <span id="enemy-hp"></span></p>
        <img id="enemy-image" src="" alt="Enemy Image" width="800">
    </div>

    <div id="character-info">
        <h2 id="player-name"></h2>
        <p>HP: <span id="player-hp"></span></p>
    </div>

    <div id="console">
        <p id='battleText'>Ambush!</p>
    </div>

    <div id="abilities">
        <h3>Abilities</h3>
    </div>

    <div id="ability-buttons">
        <button class="attack-btn" onclick="playerAttack(0)">Attack 1</button>
        <button class="attack-btn" onclick="playerAttack(1)">Attack 2</button>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const charData = params.get("character");

        if (charData) {
            const character = JSON.parse(decodeURIComponent(charData));
            playerHP = character.hp;
            playerAbilities = character.abilities;
            playerName = character.name;
        }

        function displayAbilityNames() {
            const buttons = document.querySelectorAll('.attack-btn');

            buttons.forEach((btn, index) => {
                if (playerAbilities[index]) {
                    // Create wrapper
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('ability-wrapper');

                    // Create text
                    const text = document.createElement('span');
                    text.classList.add('ability-text');
                    text.textContent = playerAbilities[index].name;

                    // Wrap button
                    btn.parentNode.insertBefore(wrapper, btn);
                    wrapper.appendChild(btn);
                    wrapper.appendChild(text);
                }
            });
        }

        // -------------------------
        // Enemy setup
        // -------------------------
        const enemyList = enemies.enemies;
        const randomEnemy = enemyList[Math.floor(Math.random() * enemyList.length)];

        let enemyName = randomEnemy.name;
        let enemyHP = randomEnemy.hp;
        const enemyAbilities = randomEnemy.abilities;
        let enemyImage = randomEnemy.animations.idle;
        const enemyFlavor = randomEnemy.flavor;

        document.getElementById('enemy-name').textContent = enemyName;
        document.getElementById('enemy-hp').textContent = enemyHP;
        document.getElementById('battleText').textContent = `A wild ${enemyName} appears! ${enemyFlavor}`;
        document.getElementById('enemy-image').src = enemyImage;

        // -------------------------
        // Initialize displays
        // -------------------------
        // Update player display
        document.getElementById('player-name').textContent = playerName;
        document.getElementById('player-hp').textContent = playerHP;

        // Update button text with imported abilities
        const buttons = document.querySelectorAll('.attack-btn');
        buttons.forEach((btn, index) => {
            if (playerAbilities[index]) {
                btn.textContent = playerAbilities[index].name;
            }
        });

        // -------------------------
        // Display update functions
        // -------------------------
        function updateEnemyDisplay() {
            console.log('Updating enemy image to:', enemyImage);
            document.getElementById('enemy-hp').textContent = enemyHP;
            document.getElementById('enemy-image').src = enemyImage;
        }

        function updatePlayerDisplay() {
            document.getElementById('player-hp').textContent = playerHP;
        }

        // -------------------------
        // Debug enemy animations
        // -------------------------
        console.log('Enemy animations:', {
            idle: randomEnemy.animations.idle,
            attack: randomEnemy.animations.attack,
            death: randomEnemy.animations.death
        });

        // Test if images load
        console.log('Testing if attack animation loads...');
        const testImg = new Image();
        testImg.onload = () => console.log('Attack animation loaded successfully');
        testImg.onerror = () => console.error('Attack animation failed to load');
        testImg.src = randomEnemy.animations.attack;

        // -------------------------
        // Battle logic functions
        // -------------------------
        function move(name, damage, heal) {
            playerHP += heal;
            enemyHP -= damage;

            if (playerHP < 0) playerHP = 0;
            if (enemyHP < 0) enemyHP = 0;

            console.log(`Player used ${name}! Deals ${damage} damage, heals ${heal}.`);
            document.getElementById('battleText').innerText = `Player used ${name}! Deals ${damage} damage, heals ${heal}.`;

            updateEnemyDisplay();
            updatePlayerDisplay();
        }

        function enemyMove(name, damage, heal) {
            enemyHP += heal;
            playerHP -= damage;

            if (playerHP < 0) playerHP = 0;
            if (enemyHP < 0) enemyHP = 0;

            console.log(`Enemy used ${name}! Deals ${damage} damage, heals ${heal}.`);
            document.getElementById('battleText').innerText = `Enemy used ${name}! Deals ${damage} damage, heals ${heal}.`;

            updateEnemyDisplay();
            updatePlayerDisplay();
        }

        // -------------------------
        // HUD rendering
        // -------------------------
        const hud = document.getElementById("character-info");

        // -------------------------
        // Attack logic
        // -------------------------
        function playerAttack(index) {
            if (!playerAbilities[index]) return;

            const ability = playerAbilities[index];
            move(ability.name, ability.damage, ability.heal);

            // Check if enemy died from player attack
            if (enemyHP <= 0) {
                enemyImage = randomEnemy.animations.death;
                updateEnemyDisplay(); // IMMEDIATELY update to show death
                checkBattleOutcome();
                return; // Don't do enemy counterattack if enemy is dead
            }

            // Enemy counterattack
            setTimeout(() => {
                // Show enemy attack animation
                enemyImage = randomEnemy.animations.attack;
                updateEnemyDisplay(); // IMMEDIATELY update to show attack

                // Wait for animation, then execute enemy move
                setTimeout(() => {
                    const enemyAbility = enemyAbilities[Math.floor(Math.random() * enemyAbilities.length)];
                    enemyMove(enemyAbility.name, enemyAbility.damage, enemyAbility.heal);

                    // Return to idle after enemy move
                    setTimeout(() => {
                        enemyImage = randomEnemy.animations.idle;
                        updateEnemyDisplay(); // IMMEDIATELY update to show idle
                        checkBattleOutcome();
                    }, 500);
                }, 1000);
            }, 500);
        }

        function checkBattleOutcome() {
            if (playerHP <= 0) {
                document.getElementById('battleText').innerText = "You were defeated!";
            } else if (enemyHP <= 0) {
                enemyImage = randomEnemy.animations.death;
                updateEnemyDisplay();
                document.getElementById('battleText').innerText = `You defeated the ${enemyName}!`;
            }
        }

        // Initial render

    </script>




</body>

</html> 



 
